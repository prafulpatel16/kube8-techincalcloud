>Kubernets Deployment strategies
three types of deployment strategies

1.rolling deployment

2.recreate

3.Canary Deployemt, blue & Green deployment, Red & Balck Deployment



--------------------------------------------------------------------------

1.rolling deployment strategies

MaxSurge
Im MaxSurge whatever pod value is being given in new replicaset based on that the pods are being created and at the same time the same number of older pods 
are being terminated.


Max Unavailable: 0 and 1
Max Unavailable: 1 - it means the number of pods will be become Unavailable first from an existing replicaset

Max Unavailable: 0 - it means the pods will not be terminated first from existing replicaset.

>Use Case: 1
Max Surge: 2
Max Unavailable: 0

This will create a new pods first from the new replicaset and then terminate the 2 pods from an existing replicaset

>Use Case: 2
Max Surge: 2
Max Unavailable: 1

This will first remove 2 pods from an existing replicaset and then it will create 2 new pods from a new replicaset. so in this Case
there will be some slight downtime can be experienced by user which is not good.


>it can be mentioned % wise as well in Max Surge and Max Unavailable

MAx Surge: 25%
Max Unavailable: 10%



--------------------------------------------------------------------------------------------------------------------

2.recreate

This is just re creating an existing pods from terminating an existing pods so there will be some downtime. so in test environment this can be done
but in prod env this is not a good option.




--------------------------------------------------------------------------------------------------------------------------
3.Canary Deployemt, blue & Green deployment, Red & Balck Deployment

Pending


--------------------------------------------------------------------------------------------------------------------

LAB

1.rolling deployment

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prafulcloud
spec:
  replicas: 4
  selector:
    matchLabels:
      app: nginx
  template:
      metadata:
        labels:
          team: nginx
      spec:
        containers:
        - name: nginx
          image: nginx:1.7.1
          ports:
            - containerPort: 80


Deploy rolling deployment

kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-techincalcloud/master/Day%2015/deployment_rolling_strategy.yml


NAME                             READY   STATUS    RESTARTS   AGE   LABELS
pod/prafulcloud-ff49c9b4-6n4tg   1/1     Running   0          24s   app=nginx,pod-template-hash=ff49c9b4
pod/prafulcloud-ff49c9b4-nnzzt   1/1     Running   0          24s   app=nginx,pod-template-hash=ff49c9b4
pod/prafulcloud-ff49c9b4-qn7k6   1/1     Running   0          24s   app=nginx,pod-template-hash=ff49c9b4
pod/prafulcloud-ff49c9b4-tkfcr   1/1     Running   0          24s   app=nginx,pod-template-hash=ff49c9b4
NAME                                   DESIRED   CURRENT   READY   AGE   LABELS
replicaset.apps/prafulcloud-ff49c9b4   4         4         4       24s   app=nginx,pod-template-hash=ff49c9b4


-----------------
root@master-node-ubnt:~# kubectl get all
NAME                             READY   STATUS    RESTARTS   AGE
pod/prafulcloud-ff49c9b4-6n4tg   1/1     Running   0          61s
pod/prafulcloud-ff49c9b4-nnzzt   1/1     Running   0          61s
pod/prafulcloud-ff49c9b4-qn7k6   1/1     Running   0          61s
pod/prafulcloud-ff49c9b4-tkfcr   1/1     Running   0          61s
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   2d19h
NAME                          READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/prafulcloud   4/4     4            4           61s
NAME                                   DESIRED   CURRENT   READY   AGE
replicaset.apps/prafulcloud-ff49c9b4   4         4         4       61s
root@master-node-ubnt:~# 

- Describe the deployment - prafulcloud and observe that it has Image:nginx:1.7.1

root@master-node-ubnt:~# kubectl describe deployment prafulcloud
Name:                   prafulcloud
Namespace:              default
CreationTimestamp:      Fri, 23 Jul 2021 21:32:01 +0000
Labels:                 app=nginx
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               app=nginx
Replicas:               4 desired | 4 updated | 4 total | 4 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=nginx
  Containers:
   nginx:
    Image:        nginx:1.7.1
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  <none>
NewReplicaSet:   prafulcloud-ff49c9b4 (4/4 replicas created)
NewReplicaSet:   prafulcloud-ff49c9b4 (4/4 replicas created)
Events:          <none>


-Describe services

root@master-node-ubnt:~# kubectl describe svc
Name:              kubernetes
Namespace:         default
Labels:            component=apiserver
                   provider=kubernetes
Annotations:       <none>
Selector:          <none>
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                10.96.0.1
IPs:               10.96.0.1
Port:              https  443/TCP
TargetPort:        6443/TCP
Endpoints:         10.128.0.10:6443
Session Affinity:  None
Events:            <none>


-Desribe replicaset

root@master-node-ubnt:~# kubectl describe rs
Name:           prafulcloud-ff49c9b4
Namespace:      default
Selector:       app=nginx,pod-template-hash=ff49c9b4
Labels:         app=nginx
                pod-template-hash=ff49c9b4
Annotations:    deployment.kubernetes.io/desired-replicas: 4
                deployment.kubernetes.io/max-replicas: 5
                deployment.kubernetes.io/revision: 1
Controlled By:  Deployment/prafulcloud
Replicas:       4 current / 4 desired
Pods Status:    4 Running / 0 Waiting / 0 Succeeded / 0 Failed
Pod Template:
  Labels:  app=nginx
           pod-template-hash=ff49c9b4
  Containers:
   nginx:
    Image:        nginx:1.7.1
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Events:           <none>



- Describe one of the pod frpm deployment and observe all the fields and values

Name:         prafulcloud-ff49c9b4-6n4tg
Namespace:    default
Priority:     0
Node:         node-2/10.128.0.14
Start Time:   Fri, 23 Jul 2021 21:32:01 +0000
Labels:       app=nginx
              pod-template-hash=ff49c9b4
Annotations:  <none>
Status:       Running
IP:           10.36.0.2
IPs:
  IP:           10.36.0.2
Controlled By:  ReplicaSet/prafulcloud-ff49c9b4
Containers:
  nginx:
    Container ID:   docker://a92277c4e80e5cdd0de43bf69c9d1ba05ae06fa50c2d68ff27f5971d45d3316a
    Image:          nginx:1.7.1
    Image ID:       docker-pullable://nginx@sha256:7fbe0579e123f3d2b29c9159e9a80547fb72621bb419e52d98c679ddbf1055a1
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Fri, 23 Jul 2021 21:32:17 +0000
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-875sf (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
  Volumes:
  kube-api-access-875sf:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:                      <none>

--------------------------------------------------------------------------------------------------------------------

Now let's do rolling deployment without defining any StrategyType on deployment which leads to terminate the existing Pods
same time while new pods are creating, however if there are heavy deployments then it may take few more minutes to deploye new pods
but the existing pods can be terminated before which can give a downtime to the end user.


Change the  deployment version nginx:1.7.1 to nginx:1.9.1 which is updating an application

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prafulcloud
  labels:
    app: nginx
spec:
  replicas: 4
  selector:
    matchLabels:
      app: nginx
  template:
      metadata:
        labels:
          app: nginx
      spec:
        containers:
        - name: nginx
          image: nginx:1.9.1
          ports:
            - containerPort: 80



root@master-node-ubnt:~# kubectl apply -f https://raw.githubusercontent.com/prafulpatel16
/kube8-techincalcloud/master/Day%2015/deployment_rolling_strategy.yml
deployment.apps/prafulcloud configured


NAME                               READY   STATUS        RESTARTS   AGE   LABELS
pod/prafulcloud-69c44dfb78-blzp4   1/1     Running       0          8s    app=nginx,pod-templ
ate-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-cm6fp   1/1     Running       0          6s    app=nginx,pod-templ
ate-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-p77hp   1/1     Running       0          6s    app=nginx,pod-templ
ate-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-rzkkz   1/1     Running       0          8s    app=nginx,pod-templ
ate-hash=69c44dfb78
pod/prafulcloud-ff49c9b4-6n4tg     0/1     Terminating   1          23h   app=nginx,pod-templ
ate-hash=ff49c9b4
pod/prafulcloud-ff49c9b4-nnzzt     0/1     Terminating   1          23h   app=nginx,pod-templ
ate-hash=ff49c9b4
pod/prafulcloud-ff49c9b4-qn7k6     0/1     Terminating   1          23h   app=nginx,pod-templ
ate-hash=ff49c9b4
pod/prafulcloud-ff49c9b4-tkfcr     0/1     Terminating   1          23h   app=nginx,pod-templ
ate-hash=ff49c9b4
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE     LABELS
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   3d19h   component=apise
rver,provider=kubernetes
NAME                          READY   UP-TO-DATE   AVAILABLE   AGE   LABELS
deployment.apps/prafulcloud   4/4     4            4           23h   app=nginx
NAME                                     DESIRED   CURRENT   READY   AGE   LABELS
replicaset.apps/prafulcloud-69c44dfb78   4         4         4       8s    app=nginx,pod-temp
late-hash=69c44dfb78
replicaset.apps/prafulcloud-ff49c9b4     0         0         0       23h   app=nginx,pod-temp
late-hash=ff49c9b4




NAME                               READY   STATUS    RESTARTS   AGE    LABELS
pod/prafulcloud-69c44dfb78-blzp4   1/1     Running   0          113s   app=nginx,pod-template
-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-cm6fp   1/1     Running   0          111s   app=nginx,pod-template
-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-p77hp   1/1     Running   0          111s   app=nginx,pod-template
-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-rzkkz   1/1     Running   0          113s   app=nginx,pod-template
-hash=69c44dfb78
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE     LABELS
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   3d19h   component=apise
rver,provider=kubernetes
NAME                          READY   UP-TO-DATE   AVAILABLE   AGE   LABELS
deployment.apps/prafulcloud   4/4     4            4           23h   app=nginx
NAME                                     DESIRED   CURRENT   READY   AGE    LABELS
replicaset.apps/prafulcloud-69c44dfb78   4         4         4       113s   app=nginx,pod-tem
plate-hash=69c44dfb78
replicaset.apps/prafulcloud-ff49c9b4     0         0         0       23h    app=nginx,pod-tem
plate-hash=ff49c9b4


-DEscribe Deployment: observe the new image with nginx:1.9.1 is updated.

root@master-node-ubnt:~# kubectl describe deployment
Name:                   prafulcloud
Namespace:              default
CreationTimestamp:      Fri, 23 Jul 2021 21:32:01 +0000
Labels:                 app=nginx
Annotations:            deployment.kubernetes.io/revision: 2
Selector:               app=nginx
Replicas:               4 desired | 4 updated | 4 total | 4 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=nginx
  Containers:
   nginx:
    Image:        nginx:1.9.1
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  <none>
NewReplicaSet:   prafulcloud-69c44dfb78 (4/4 replicas created)
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------

  -Describe pod: observe the new image with nginx:1.9.1 is updated.


  root@master-node-ubnt:~# kubectl describe pod prafulcloud-69c44dfb78-blzp4 
  Name:         prafulcloud-69c44dfb78-blzp4
  Namespace:    default
  Priority:     0
  Node:         node-2/10.128.0.14
  Start Time:   Sat, 24 Jul 2021 21:00:26 +0000
  Labels:       app=nginx
                pod-template-hash=69c44dfb78
  Annotations:  <none>
  Status:       Running
  IP:           10.36.0.3
  IPs:
    IP:           10.36.0.3
  Controlled By:  ReplicaSet/prafulcloud-69c44dfb78
  Containers:
    nginx:
      Container ID:   docker://fd6d0ded3684746c1cab18ec8a3e7354360d0eef1c84e24bc2ca5a9b0036
  0cbd
      Image:          nginx:1.9.1
      Image ID:       docker-pullable://nginx@sha256:2f68b99bc0d6d25d0c56876b924ec20418544f
  f28e1fb89a4c27679a40da811b
      Port:           80/TCP
      Host Port:      0/TCP
      State:          Running

- Deploy pod deployment using RollingUpdate strategy MaxSurge and maxUnavailable

In this type of deployment when maxSurge: 1, maxUnavailable: 0, it means first one prod will be created from the new replicaset
and then one pod will be terminated from an existing replicaset until the desired value of the resplicaset is fulfilled.

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prafulcloud
  labels:
    app: nginx
spec:
  replicas: 4
  strategy:
    rollingUpdate:
       maxSurge: 1
       maxUnavailable: 0
    type: RollingUpdate   
  selector:
    matchLabels:
      app: nginx
  template:
      metadata:
        labels:
          app: nginx
      spec:
        containers:
        - name: nginx
          image: nginx:1.10.1
          ports:
            - containerPort: 80


kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-techincalcloud/master/Day%2015/deployment_rollingUpdate_strategy.yml


NAME                               READY   STATUS              RESTARTS   AGE     L
ABELS
pod/prafulcloud-69c44dfb78-cm6fp   1/1     Running             1          3h12m   a
pp=nginx,pod-template-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-p77hp   1/1     Running             1          3h12m   a
pp=nginx,pod-template-hash=69c44dfb78
pod/prafulcloud-69c44dfb78-rzkkz   1/1     Running             1          3h12m   a
pp=nginx,pod-template-hash=69c44dfb78
pod/prafulcloud-74f95d5d7b-vpnr6   0/1     ContainerCreating   0          6s      a
pp=nginx,pod-template-hash=74f95d5d7b
pod/prafulcloud-74f95d5d7b-wcqlg   1/1     Running             0          14s     a
pp=nginx,pod-template-hash=74f95d5d7b

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE     LABEL
S
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   3d22h   compo
nent=apiserver,provider=kubernetes

NAME                          READY   UP-TO-DATE   AVAILABLE   AGE   LABELS
deployment.apps/prafulcloud   4/4     2            4           26h   app=nginx

NAME                                     DESIRED   CURRENT   READY   AGE     LABELS
replicaset.apps/prafulcloud-69c44dfb78   3         3         3       3h12m   app=ng
inx,pod-template-hash=69c44dfb78
replicaset.apps/prafulcloud-74f95d5d7b   2         2         1       14s     app=ng
inx,pod-template-hash=74f95d5d7b
replicaset.apps/prafulcloud-ff49c9b4     0         0         0       26h     app=ng
inx,pod-template-hash=ff49c9b4



- describe deployment and observe all the fields of replicas and RollingUpdateStrategy

root@master-node-ubnt:~# kubectl describe deployment
Name:                   prafulcloud
Namespace:              default
CreationTimestamp:      Fri, 23 Jul 2021 21:32:01 +0000
Labels:                 app=nginx
Annotations:            deployment.kubernetes.io/revision: 3
Selector:               app=nginx
Replicas:               4 desired | 4 updated | 4 total | 4 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  0 max unavailable, 1 max surge
Pod Template:
  Labels:  app=nginx
  Containers:
   nginx:
    Image:        nginx:1.10.1
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  <none>
NewReplicaSet:   prafulcloud-74f95d5d7b (4/4 replicas created)
Events:
  Type    Reason             Age   From                   Message
  ----    ------             ----  ----                   -------
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled up replica set prafulcloud-74f95d5d7b to 1
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled down replica set prafulcloud-69c44dfb78 to 3
  a set prafulcloud-69c44dfb78 to 3
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled up replica 
set prafulcloud-74f95d5d7b to 2
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled down replic
a set prafulcloud-69c44dfb78 to 2
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled up replica 
set prafulcloud-74f95d5d7b to 3
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled down replic
a set prafulcloud-69c44dfb78 to 1
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled up replica 
set prafulcloud-74f95d5d7b to 4
  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled down replic
a set prafulcloud-69c44dfb78 to 0

- Describe pods

root@master-node-ubnt:~# kubectl get pods
NAME                           READY   STATUS    RESTARTS   AGE
prafulcloud-74f95d5d7b-7qr5q   1/1     Running   0          43m
prafulcloud-74f95d5d7b-ttdgm   1/1     Running   0          43m
prafulcloud-74f95d5d7b-vpnr6   1/1     Running   0          43m
prafulcloud-74f95d5d7b-wcqlg   1/1     Running   0          43m
root@master-node-ubnt:~# kubectl describe pod prafulcloud-74f95d5d7b-7qr5q 
Name:         prafulcloud-74f95d5d7b-7qr5q
Namespace:    default
Priority:     0
Node:         node-2/10.128.0.14
Start Time:   Sun, 25 Jul 2021 00:12:46 +0000
Labels:       app=nginx
              pod-template-hash=74f95d5d7b
Annotations:  <none>
Status:       Running
IP:           10.36.0.2
IPs:
  IP:           10.36.0.2
Controlled By:  ReplicaSet/prafulcloud-74f95d5d7b
Containers:
  nginx:
    Container ID:   docker://70515012d59020846fae1fa58e78c9609dea38caf265526836b9fe5
6a9046f5b
    Image:          nginx:1.10.1
    Image ID:       docker-pullable://nginx@sha256:35779791c05d119df4fe476db8f47c0be
e5943c83eba5656a15fc046db48178b
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sun, 25 Jul 2021 00:12:47 +0000
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-p6p7m (ro)
Page down
Image:          nginx:1.10.1
    Image ID:       docker-pullable://nginx@sha256:35779791c05d119df4fe476db8f47c0be
e5943c83eba5656a15fc046db48178b
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sun, 25 Jul 2021 00:12:47 +0000
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-p6p7m (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
kube-api-access-p6p7m:
    Type:                    Projected (a volume that contains injected data from mu
ltiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 30
0s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 
300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  43m   default-scheduler  Successfully assigned default/prafulcl
oud-74f95d5d7b-7qr5q to node-2
  Normal  Pulled     43m   kubelet            Container image "nginx:1.10.1" already
 present on machine
  Normal  Created    43m   kubelet            Created container nginx
  Normal  Started    43m   kubelet            Started container nginx

- Deploy 4 new pods first from replicaset
UseCase 2:
maxSurge: 4
maxUnavailable: 0

Objective: Deployt 4 new pods first from new replicaset and then terminate 4 pods from the existing replicaset

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prafulcloud
  labels:
    app: nginx
spec:
  replicas: 4
  strategy:
     type: RollingUpdate
     rollingUpdate:
       maxSurge: 4
       maxUnavailable: 0
  selector:
    matchLabels:
      app: nginx
  template:
      metadata:
        labels:
          app: nginx
      spec:
        containers:
        - name: nginx
          image: nginx:1.11.1
          ports:
            - containerPort: 80


kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-techincalcloud/master/Day%2015/deployment_rollingUpdate_strategy.yml

NAME                               READY   STATUS              RESTARTS   AGE   LAB
ELS
pod/prafulcloud-74f95d5d7b-wcqlg   1/1     Running             0          62m   app
=nginx,pod-template-hash=74f95d5d7b
pod/prafulcloud-c85b9d55-6rxpn     1/1     Running             0          11s   app
=nginx,pod-template-hash=c85b9d55
pod/prafulcloud-c85b9d55-8rfwk     1/1     Running             0          9s    app
=nginx,pod-template-hash=c85b9d55
pod/prafulcloud-c85b9d55-mw9nd     1/1     Running             0          21s   app
=nginx,pod-template-hash=c85b9d55
pod/prafulcloud-c85b9d55-rx5qt     0/1     ContainerCreating   0          7s    app
=nginx,pod-template-hash=c85b9d55
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE     LABEL
S
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   3d23h   compo
nent=apiserver,provider=kubernetes
NAME                          READY   UP-TO-DATE   AVAILABLE   AGE   LABELS
deployment.apps/prafulcloud   4/4     4            4           27h   app=nginx
NAME                                     DESIRED   CURRENT   READY   AGE     LABELS
replicaset.apps/prafulcloud-69c44dfb78   0         0         0       4h14m   app=ng
inx,pod-template-hash=69c44dfb78
replicaset.apps/prafulcloud-74f95d5d7b   1         1         1       62m     app=ng
inx,pod-template-hash=74f95d5d7b
replicaset.apps/prafulcloud-c85b9d55     4         4         3       21s     app=ng
inx,pod-template-hash=c85b9d55
replicaset.apps/prafulcloud-ff49c9b4     0         0         0       27h     app=ng
inx,pod-template-hash=ff49c9b4


--------------------------------------------------------------------------------------------------------------------

UseCase: 3
Objective: In this case first 2 pods will be unavailable from existing replicaset and then new pods will be become available
from new replicaset
maxSurge: 0
maxUnavailable: 2

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prafulcloud
  labels:
    app: nginx
spec:
  replicas: 4
  strategy:
     type: RollingUpdate
     rollingUpdate:
       maxSurge: 0
       maxUnavailable: 2
  selector:
    matchLabels:
      app: nginx
  template:
      metadata:
        labels:
          app: nginx
      spec:
        containers:
        - name: nginx
          image: nginx:1.12.1
          ports:
            - containerPort: 80



kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-techincalcloud/master/Day%2015/deployment_rollingUpdate_maxUnava_strategy.yml


--------------------------------------------------------------------------------------------------------------------

UseCase: 4
Objective: In this case first new 25% pods will be available from new replicaset and then 10% will be become unavailable
from existing replicaset
maxSurge: 25%
maxUnavailable: 10%

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prafulcloud
  labels:
    app: nginx
spec:
  replicas: 4
  strategy:
     type: RollingUpdate
     rollingUpdate:
       maxSurge: 25%
       maxUnavailable: 10%
  selector:
    matchLabels:
      app: nginx
  template:
      metadata:
        labels:
          app: nginx
      spec:
        containers:
        - name: nginx
          image: nginx:1.13.1
          ports:
            - containerPort: 80


kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-techincalcloud/master/Day%2015/deployment_rollingUpdate_maxUnava_strategy.yml


NAME                               READY   STATUS        RESTARTS   AGE   LABELS
pod/prafulcloud-59d674869-2xmbv    1/1     Running       0          14s   app=nginx,p
od-template-hash=59d674869
pod/prafulcloud-59d674869-b5pn4    1/1     Running       0          6s    app=nginx,p
od-template-hash=59d674869
pod/prafulcloud-59d674869-bjq2m    1/1     Running       0          19s   app=nginx,p
od-template-hash=59d674869
pod/prafulcloud-59d674869-blm76    1/1     Running       0          8s    app=nginx,p
od-template-hash=59d674869
pod/prafulcloud-77bfbbccc4-cnsk9   0/1     Terminating   0          14m   app=nginx,p
od-template-hash=77bfbbccc4

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   LABELS
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   4d    component
=apiserver,provider=kubernetes

NAME                          READY   UP-TO-DATE   AVAILABLE   AGE   LABELS
deployment.apps/prafulcloud   4/4     4            4           28h   app=nginx

NAME                                     DESIRED   CURRENT   READY   AGE     LABELS
replicaset.apps/prafulcloud-59d674869    4         4         4       19s     app=ngin
x,pod-template-hash=59d674869
replicaset.apps/prafulcloud-69c44dfb78   0         0         0       4h50m   app=ngin
x,pod-template-hash=69c44dfb78
replicaset.apps/prafulcloud-74f95d5d7b   0         0         0       98m     app=ngin
x,pod-template-hash=74f95d5d7b
replicaset.apps/prafulcloud-77bfbbccc4   0         0         0       14m     app=ngin
x,pod-template-hash=77bfbbccc4
replicaset.apps/prafulcloud-c85b9d55     0         0         0       37m     app=ngin
x,pod-template-hash=c85b9d55
replicaset.apps/prafulcloud-ff49c9b4     0         0         0       28h     app=ngin
x,pod-template-hash=ff49c9b4



 
